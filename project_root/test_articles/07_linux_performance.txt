Мониторинг производительности Linux: инструменты диагностики и оптимизации

Диагностика узких мест производительности в Linux требует понимания метрик системы и специализированных утилит. Симптомы — медленный отклик приложений, высокая нагрузка, зависания — могут иметь десятки причин от перегрузки CPU до исчерпания дискового I/O.

top и htop показывают процессы в реальном времени: использование CPU, памяти, время работы. Load average — средняя длина очереди готовых к выполнению процессов за 1, 5, 15 минут. Значение выше количества CPU-ядер сигнализирует о перегрузке. us (user) и sy (system) показывают время в пользовательском и ядерном режимах, wa (iowait) — простой в ожидании I/O.

iostat детализирует дисковую активность: количество операций чтения/записи в секунду, пропускная способность в MB/s, утилизация диска в процентах. 100% утилизация означает, что диск постоянно занят — узкое место. Параметр await показывает среднее время отклика дисковых запросов; высокие значения (>10ms для SSD, >20ms для HDD) указывают на проблемы.

vmstat мониторит виртуальную память: свободная RAM, swap использование, скорость paging. Активный swap (si/so колонки) критичен — система меняет страницы памяти на диск, катастрофически замедляя работу. Решение — увеличить RAM или оптимизировать потребление памяти приложениями.

netstat и ss анализируют сетевые соединения: активные TCP-подключения, listening порты, статистику интерфейсов. Большое количество TIME_WAIT сокетов после нагрузочных тестов нормально, но может исчерпать ephemeral порты. Параметры ядра net.ipv4.tcp_tw_reuse и tcp_fin_timeout оптимизируют повторное использование сокетов.

perf — мощный профайлер, использующий аппаратные счётчики CPU. perf top показывает функции, потребляющие больше всего циклов процессора. perf record собирает данные, perf report визуализирует flame graphs. Идентификация горячих участков кода позволяет сфокусировать оптимизацию.
